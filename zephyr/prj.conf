# MP3 Rewind Media Player - Audio Streaming Configuration
# Audio system with PWM buzzer output

# Enable logging
CONFIG_LOG=y
CONFIG_LOG_BACKEND_UART=y
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_MAX_LEVEL=4

# Enable console and printk
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
CONFIG_PRINTK=y
CONFIG_SERIAL=y
CONFIG_STDOUT_CONSOLE=y

# UART configuration for better output
CONFIG_UART_USE_RUNTIME_CONFIGURE=y

# Enable PWM for audio output
CONFIG_PWM=y

# Enable GPIO and LEDs
CONFIG_GPIO=y
CONFIG_LED=y

# Enable heap and memory management - reduced for stability
CONFIG_MAIN_STACK_SIZE=3072
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1536

# Additional memory optimizations - reduced stacks to prevent overflow
CONFIG_NET_TCP_WORKQ_STACK_SIZE=1536
CONFIG_NET_MGMT_EVENT_STACK_SIZE=768
CONFIG_IDLE_STACK_SIZE=384

# Enable threads and scheduling
CONFIG_MULTITHREADING=y
CONFIG_NUM_PREEMPT_PRIORITIES=15

# Enable debug features
CONFIG_DEBUG=y
CONFIG_DEBUG_INFO=y
CONFIG_ASSERT=y

# Enable error handling
CONFIG_REBOOT=y

# Enable string functions (use newer POSIX API)
CONFIG_POSIX_API=y

# Enable networking for HTTP client
CONFIG_NETWORKING=y
CONFIG_NET_IPV4=y
CONFIG_NET_TCP=y
CONFIG_NET_SOCKETS=y

# Enable WiFi for B-L475E-IOT01A
CONFIG_WIFI=y
CONFIG_WIFI_ESWIFI=y

# WiFi driver specific configuration
CONFIG_WIFI_ESWIFI_BUS_SPI=y

# Network management and WiFi control
CONFIG_NET_MGMT=y
CONFIG_NET_MGMT_EVENT=y

# DHCP client for automatic IP assignment
CONFIG_NET_DHCPV4=y

# Network shell for WiFi debugging (disabled to clean output)
CONFIG_SHELL=n
CONFIG_NET_SHELL=n

# Network buffer configuration - reduced to conserve memory 
CONFIG_NET_BUF_RX_COUNT=12
CONFIG_NET_BUF_TX_COUNT=6
CONFIG_NET_PKT_RX_COUNT=10
CONFIG_NET_PKT_TX_COUNT=4

# Reduce buffer size to prevent memory overflow - smaller for tight memory constraints
CONFIG_NET_BUF_DATA_SIZE=512

# Reduce heap size for network and audio buffers to prevent overflow
CONFIG_HEAP_MEM_POOL_SIZE=12288

# Enable stack overflow detection
CONFIG_HW_STACK_PROTECTION=y
CONFIG_THREAD_STACK_INFO=y

# HTTP client support
CONFIG_HTTP_CLIENT=y

# Enable Bluetooth LE with ST SPBTLE-RF (BlueNRG-MS) driver
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_CENTRAL=y
CONFIG_BT_MAX_CONN=1
CONFIG_BT_MAX_PAIRED=1

# Basic Bluetooth HCI - let device tree auto-select SPI driver
CONFIG_BT_HCI=y

# Enable SPI for SPBTLE-RF communication
CONFIG_SPI=y

# Basic GATT support  
CONFIG_BT_GATT_DYNAMIC_DB=y
CONFIG_BT_GATT_CLIENT=y

# Enable BLE advertising and device name
CONFIG_BT_BROADCASTER=y
CONFIG_BT_OBSERVER=y
CONFIG_BT_DEVICE_NAME_DYNAMIC=y

# Bluetooth LE advertising
CONFIG_BT_DEVICE_APPEARANCE=833

# Note: Using board's built-in SPBTLE-RF module via SPI3

# Bluetooth device name
CONFIG_BT_DEVICE_NAME="MP3-Rewind"

# Disable unused features to save space  
CONFIG_USB_DEVICE_STACK=n

# Thread configuration - optimized for memory but allowing Bluetooth priorities
CONFIG_THREAD_NAME=y
CONFIG_THREAD_STACK_INFO=y

# Timer configuration
CONFIG_SYS_CLOCK_TICKS_PER_SEC=1000

# MPU configuration for STM32L4
CONFIG_ARM_MPU=y

# Memory optimization settings
CONFIG_SIZE_OPTIMIZATIONS=y
CONFIG_DEBUG_OPTIMIZATIONS=y
CONFIG_NO_OPTIMIZATIONS=n

# Reduce memory usage
CONFIG_KERNEL_MEM_POOL=y
CONFIG_MAIN_THREAD_PRIORITY=7

# Disable unused subsystems to save memory
CONFIG_CONSOLE_SUBSYS=n
CONFIG_CONSOLE_GETCHAR=n